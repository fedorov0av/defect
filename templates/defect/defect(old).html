<!doctype html>
<html lang="ru" data-bs-theme="auto">
  <head>
    <!-- Подключиение js-файла фреймворка Bootstrap 3 -->
    <link href="{{ url_for('static_css', path='bootstrap.min.css') }}" rel="stylesheet" crossorigin="anonymous">
    <script src="{{ url_for('static_js', path='jquery.min.js') }}"></script>
    
    <script src="{{ url_for('static_js', path='sweetalert2.js') }}"></script>
    <script src="{{ url_for('static_js', path='defect-color-modes.js') }}"></script>
    <script src="{{ url_for('static_js', path='vue3.js') }}"></script>
    <script src="{{ url_for('static_js', path='axios.min.js') }}"></script>
    <script src="{{ url_for('static_js', path='moment.min.js') }}"></script>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Fedorov A., Baibekov V., Petrov T.">
    <meta name="generator" content="Hugo 0.118.2">
    <title>Журнал учета дефектов</title>

    <link rel="stylesheet" href="{{ url_for('static_css', path='defect-styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static_css', path='mystyles.css') }}">

    <!-- Custom styles for this template -->
    <link href="{{ url_for('static_css', path='defect.css') }}" rel="stylesheet">
  </head>

{% raw %}
<div id='vueHead'>
  <header class="p-3 text-bg-dark">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
        <h2 class="" href="#" >Журнал учета дефектов</h2>
        <div class="text-end lastbutton">
          <a class="navbar-brand  col-lg-2 rr px-3 fs-6 text-white" href="#">{{ userFioEmail }}</a>
          <button @click="logOut" type="button" class="btn btn-warning me-2">LogOut</button>
        </div>
      </div>
    </div>
  </header>
</div>
{% endraw %}
<!----------------------------------------Меню навигации------------------------------------------>
{% raw %}
<nav id="vueNav" class="navbar">
  <form class="container-fluid justify-content-start">
    <div class="btn-group">
      <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#AddDefectModalWindow">
        Зарегистрировать дефект
      </button>
    </div>
    <div class="lastbutton">
      <button id="show-modal" @click="showModalUsers" class="btn btn-primary me-2" data-bs-toggle="modal" data-bs-target="#UserModalWindow" type="button">
        Пользователи
      </button>
      <transition name="modal">
      <modal v-if="showModal" @close="showModal = false">
    </div> 
    <div> 
      <button class="btn btn-primary me-2" type="button">Экспорт в Excel</button>
<!--       <button @click="logOut" class="btn btn-outline-primary me-2" type="button">LogOut</button> -->
    </div>
  </form>
</nav>
<!----------------------------------------Меню фильтров------------------------------------------>
<div id='vueFilter'>
  <div class="d-flex justify-content-start block_filter">
    <div>
      <p class="mylabel">Фильтры:</p>
    </div>
    <select class="form-select form-select1 type-defect" aria-label="Default select example">
      <option disabled selected>Подразделение</option>
      <option v-for="division in divisions" :value="division.division_id">{{ division.division_name }}</option>
    </select>
    
    <div class="mydatechoise justify-content-center">
      <div>
        <p class="mylabel">Начало:</p>
      </div>
      <div class="block_data col-lg-3 col-sm-6">
          <input id="startDate" class="form-control" type="date" />
          <!-- <span id="startDateSelected"></span> -->
      </div>
      <div>
        <p class="mylabel">Конец:</p>
      </div>
      <div class="block_data col-lg-3 col-sm-6">
          <input id="endDate" class="form-control" type="date" />
          <!-- <span id="endDateSelected"></span> -->
      </div>
    </div>

    <select class="form-select form-select1 type-defect" aria-label="Default select example">
      <option selected>Статус дефекта</option>
      <option value="1">Зарегистрирован</option>
      <option value="2">Подтвержден</option>
      <option value="3">Адресован</option>
      <option value="4">Требует корректировки</option>
      <option value="5">Принят к исполнению</option>
      <option value="6">Работы завершены</option>
      <option value="7">Устранен</option>
      <option value="8">Не устранен</option>
      <option value="9">Закрыт</option>
      <option value="9">Отменен</option>
    </select>

    <select class="form-select form-select1 type-defect" aria-label="Default select example">
      <option selected>Ответственный</option>
      <option value="1">Владелец оборудования</option>
      <option value="2">Руководитель ремонта</option>
      <option value="3">Исполнитель ремонта</option>
      <option value="4">Оперативный персонал</option>
    </select>

    <div>
      <button type="submit" class="btn btn-primary">Применить</button>
    </div>
    <div class="lastbutton">
      <button type="submit" class="btn btn-primary button-text">
        <span class="button-text">Скрыть закрытые дефекты</span>
      </button>
    </div>
  </div>
</div>
<!----------------------------------------Модальное окно "Пользователи"------------------------------------------>

<div id="vueUser">
  <div class="modal fade" id="UserModalWindow" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Пользователи</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="table-responsive small">
            <table class="table table-striped table-sm">
              <thead>
                <tr>
                  <th v-for="colunmName in colunmsName">{{ colunmName }}</th>
                </tr>
              </thead>
              <tbody>
                <!--<button id="show-modal" @click="showModalUsers" class="btn btn-outline-success me-2" 
                  data-bs-toggle="modal" data-bs-target="#UserModalWindow" type="button">Пользователи</button>-->
                <tr @dblclick="handleDoubleClick" data-bs-target="#CardUserModalWindow" v-for="user in users">
                  <td >{{ user.user_id }}</td>
                  <td >{{ user.user_surname }}</td>
                  <td >{{ user.user_name }}</td>
                  <td >{{ user.user_fathername }}</td>
                  <td >{{ user.user_position }}</td>
                  <td >{{ user.user_division }}</td>
                  <td >{{ user.user_role }}</td>
                  <td >{{ user.user_email }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button id="show-modal1" @click="updateTableRole" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#AddUserModalWindow" type="button">Добавить</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
        </div>
      </div>
    </div>
  </div>

 <!--  <marquee direction="right" scrollamount="10">Nasdaq +2,34%, Nyse +1,75, DowJons -0,5%</marquee> -->


  <!----------------------------------------Модальное окно "Добавить пользователя"------------------------------------------>
  <div id="AddUserModalWindow" class="modal fade"  ref="vueAddUserModalWindow" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Добавление пользователя</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeModalAddUser"></button>
        </div>
        <div class="modal-body">
          <form method="post">
              <input type="hidden" class="form-control" name="id" value="<?= $employee['id'] ?>">
              <div class="block_data1">
                <div class="block_input_data"><b>Фамилия</b></div>
                  <input type="text" class="form-control" name="surname" v-model="newUserSurname" placeholder="Фамилия">
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Имя</b></div>
                <input type="text" class="form-control" name="name" v-model="newUserName" placeholder="Имя">
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Отчество</b></div>
                  <input type="text" class="form-control" name="fathername" v-model="newUserFathername" placeholder="Отчество">
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Должность</b></div>
                  <input type="text" class="form-control" name="position" v-model="newUserPosition" placeholder="Должность">
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Отдел</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="newUserDivision">
                    <option disabled selected>Выберите подразделение</option>
                    <option v-for="division in divisions">{{ division.division_name }}</option>
                  </select> 
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Роль пользователя</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="newUserRole">
                    <option disabled selected>Выберите роль пользователя</option>
                    <option v-for="role in roles">{{ role.role_name }}</option>
                  </select>
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>E-mail</b></div>
                  <input type="email" class="form-control" name="email" v-model="newUserEmail" placeholder="E-mail">
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Временный пароль</b></div>
                  <input type="text" class="form-control" name="password" v-model="newUserTempPassword" placeholder="Временный пароль">
              </div>
              <div class="modal-footer">
                <button @click="addNewUser" class="btn btn-primary" type="button">Сохранить</button>
              </div>
            </form>
        </div>
      </div>
    </div>
  </div>
  <!----------------------------------------Модальное окно "Карточка пользователя"------------------------------------------>
  <div class="modal fade" id="CardUserModalWindow" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-target="#myModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Карточка пользователя</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeModalCardUser"></button>
        </div>
        <div class="modal-body">
          <form method="post">
              <input type="hidden" class="form-control" name="id" value="<?= $employee['id'] ?>">
              <div class="block_data1">
                <div class="block_input_data"><b>Фамилия</b></div>
                  <input type="text" class="form-control" name="surname" v-model="cardUserSurname" placeholder="Фамилия">
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Имя</b></div>
                <input type="text" class="form-control" name="name" v-model="cardUserName" placeholder="Имя">
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Отчество</b></div>
                  <input type="text" class="form-control" name="fathername" v-model="cardUserFathername" placeholder="Отчество">
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Должность</b></div>
                  <input type="text" class="form-control" name="position" v-model="cardUserPosition" placeholder="Должность">
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Отдел</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardUserDivision">
                    <option disabled selected>Выберите подразделение</option>
                    <option v-for="division in divisions">{{ division.division_name }}</option>
                  </select> 
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>Роль пользователя</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardUserRole">
                    <option disabled selected>Выберите роль пользователя</option>
                    <option v-for="role in roles">{{ role.role_name }}</option>
                  </select>
              </div>
              <div class="block_data1">
                <div class="block_input_data"><b>E-mail</b></div>
                  <input type="email" class="form-control" name="email" v-model="cardUserEmail" placeholder="E-mail">
              </div>
              <div class="modal-footer">
                <button @click="editUser" class="btn btn-primary" type="button">Изменить</button>
              </div>
            </form>
        </div>
      </div>
    </div>
  </div>
</div>



<!----------------------------------------Модальное окно "Добавить дефект"------------------------------------------>
<div id="vueAddDefect">
  <div class="modal fade" id="AddDefectModalWindow" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header status_add_defect">
          <h2 class="modal-title" id="exampleModalLabel">Регистрация дефекта</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeModalAddDefect"></button>
        </div>
        <div class="modal-body">
          <form method="post">
              <input type="hidden" class="form-control" name="id" value="<?= $employee['id'] ?>">

              <div class="block_row">
                <div class="block_data2">
                  <div class="block_input_data"><b>Тип дефекта</b></div>
                    <select class="form-select" aria-label="Default select example" v-model="newTypeDefect">
                      <option disabled selected>Выберите тип дефекта</option>
                      <option v-for="defect_type_defect in defect_type_defects">{{ defect_type_defect.type_defect_name }}</option>
                    </select>
                </div>
                <div class="block_data2">
                    <div class="block_input_data"><b>Статус дефекта</b></div>
                      <select class="form-select" v-model="newTypeDefect" aria-label="Disabled select example" disabled>
                        <option disabled selected>Выберите тип дефекта</option>
                        <option v-for="defect_type_defect in defect_type_defects"></option>
                      </select>
                </div>
              </div>

              <div class="block_row">
                <div class="block_data2">
                  <div class="block_input_data">
                    <b>KKS</b>
                  </div>
                  <input type="text" class="form-control" v-model="newSystemKKS" placeholder="xxxx xxxx xxxx xxxx"
                  data-hs-mask-options='{
                    "template": "0000 0000 0000 0000"
                  }'>
                </div>
                <div class="block_data2">
                    <div class="block_input_data">
                      <b>Оборудование</b>
                    </div>
                    <input type="text" class="form-control" v-model="newSystemName" placeholder="Оборудование">
                </div>
              </div>

              <div class="block_row">
                <div class="block_data3">
                  <div class="block_input_data"><b>Описание дефекта</b></div>
                  <textarea class="form-control" v-model="newDefectNotes" placeholder="Описание дефекта"></textarea>
                </div>
                <div class="block_data3">
                  <div class="block_input_data"><b>Местоположение</b></div>
                  <textarea class="form-control" v-model="newLocation" placeholder="Местоположение"></textarea>
                </div>
              </div>

              <div class="block_row">
                <div class="block_data2">
                  <div class="block_input_data"><b>Подразделение-владелец</b></div>
                    <select class="form-select" aria-label="Default select example" v-model="newDivisionOwner" disabled>
                      <option disabled selected>Выберите подразделение</option>
                      <option v-for="division in defect_divisions">{{ division.division_name }}</option>
                    </select> 
                </div>
                <div class="block_data2">
                  <div class="block_input_data"><b>Обнаружил дефект</b></div>
                    <select class="form-select" aria-label="Disabled select example" v-model="newDivisionOwner" disabled>
                      <option disabled selected>Выберите подразделение</option>
                      <option v-for="division in defect_divisions"></option>
                    </select> 
                </div>
              </div>

              <div class="block_row">
                <div class="block_data2">
                  <div class="block_input_data">
                    <b>Дата регистрации</b>
                  </div>
                  <input type="text" class="form-control" placeholder="Дата регистрации"  aria-label="readonly input example" disabled>
              </div>
                <div class="block_data2">
                  <div class="block_input_data"><b>Руководитель ремонта</b></div>
                    <select class="form-select" aria-label="Disabled select example" v-model="newDivisionOwner" disabled>
                      <option disabled selected>Выберите подразделение</option>
                      <option v-for="division in defect_divisions"></option>
                    </select> 
                </div>
              </div>

              <div class="block_row">
                <div class="block_data2">
                  <div class="block_input_data"><b>Срок устранения</b></div>
                    <input class="form-control" type="date" disabled>
                </div>
                <div class="block_data2">
                  <div class="block_input_data"><b>Исполнитель ремонта</b></div>
                    <select class="form-select" aria-label="Disabled select example" v-model="newDivisionOwner" disabled>
                      <option disabled selected>Выберите подразделение</option>
                      <option v-for="division in defect_divisions"></option>
                    </select> 
                </div>
              </div>

              <div class="block_row">
                <div class="block_data4">
                  <div class="block_input_data"><b>Выполненные работы</b></div>
                  <textarea class="form-control" placeholder="Комментарий исполнителя" aria-label="Disabled input example" disabled readonly></textarea>
                </div>
              </div>

              <div class="block_row">
                <div class="block_data2">
                  <div class="block_input_data"><b>Выполнил проверку</b></div>
                    <select class="form-select" aria-label="Disabled select example" v-model="newDivisionOwner" disabled>
                      <option disabled selected>Выберите подразделение</option>
                      <option v-for="division in defect_divisions"></option>
                    </select> 
                </div>
                <div class="block_data2">
                  <div class="block_input_data">
                    <b>Результат проверки</b>
                  </div>
                  <input type="text" class="form-control" placeholder="Результат проверки"  aria-label="readonly input example" disabled>
                </div>
              </div>
              
              <div class="modal-footer">
                <button @click="addNewDefect" class="btn btn-primary" type="button">Зарегистрировать</button>
              </div>
            </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!----------------------------------------Модальное окно "Подтвердить дефект"------------------------------------------>
<div id="vueConfirmDefect">
  <div class="modal fade" id="ConfirmDefectModalWindow" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" ref="modalConfirmDefectModalWindow">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header status_confirm_defect">
          <h2 class="modal-title" id="exampleModalLabel">Подтверждение дефекта №</h2>
          <h2 class="modal-title" id="exampleModalLabel"> {{ cardDefectID }}</h2>
          <button type="button" class="btn-close"  data-bs-dismiss="modal" aria-label="Close" id="closeConfirmDefectModalWindow"></button>
        </div>
        <div class="modal-body">
          <form method="post">
            <input type="hidden" class="form-control" name="id" value="<?= $employee['id'] ?>">

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Тип дефекта</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardTypeDefectName">
                    <option disabled selected>Выберите тип дефекта</option>
                    <option v-for="defect_type_defect in defect_type_defects">{{ defect_type_defect.type_defect_name }}</option>
                  </select>
              </div>
              <div class="block_data2">
                  <div class="block_input_data"><b>Статус дефекта</b></div>
                    <input type="text" class="form-control" v-model="cardStatusDefectName" placeholder="Статус дефекта" disabled>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data">
                  <b>KKS</b>
                </div>
                <input type="text" class="form-control" v-model="cardKKS" placeholder="xxxx xxxx xxxx xxxx"
                data-hs-mask-options='{
                  "template": "0000 0000 0000 0000"
                }'>
              </div>
              <div class="block_data2">
                  <div class="block_input_data">
                    <b>Оборудование</b>
                  </div>
                  <input type="text" class="form-control" v-model="cardSystemName" placeholder="Оборудование">
              </div>
            </div>

            <div class="block_row">
              <div class="block_data3">
                <div class="block_input_data"><b>Описание дефекта</b></div>
                <textarea class="form-control" v-model="cardDescription" placeholder="Описание дефекта"></textarea>
              </div>
              <div class="block_data3">
                <div class="block_input_data"><b>Местоположение</b></div>
                <textarea class="form-control" v-model="cardLocation" placeholder="Местоположение"></textarea>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Подразделение-владелец</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardDivisionOwner">
                    <option disabled selected>Выберите подразделение</option>
                    <option v-for="division in defect_divisions">{{ division.division_name }}</option>
                  </select> 
              </div>
              <div class="block_data2">
                <div class="block_input_data"><b>Обнаружил дефект</b></div>
                  <input type="text" class="form-control" placeholder="Обнаружил дефект"  aria-label="readonly input example" v-model="cardRegistrator" disabled>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data">
                  <b>Дата регистрации</b>
                </div>
                <input type="text" class="form-control" placeholder="Дата регистрации" v-model="cardDateRegistration" disabled>
            </div>
              <div class="block_data2">
                <div class="block_input_data"><b>Руководитель ремонта</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="newRepairManager_id">
                    <option selected disabled>Выберите руководителя ремонта</option>
                    <option v-for="repair_manager in repair_managers" :value="repair_manager.user_id">{{ repair_manager.user_surname + ' ' + repair_manager.user_name }}</option>
                  </select> 
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Срок устранения</b></div>
                  <input v-model="newDate" class="form-control" type="date" />
              </div>
              <div class="block_data2">
                <div class="block_input_data"><b>Исполнитель ремонта</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardWorker" disabled>
                    <option selected disabled>Выберите исполнителя ремонта</option>
                    <option v-for="worker in workers">{{ worker.user_surname + ' ' + worker.user_name }}</option>
                  </select> 
              </div>
            </div>

            <div class="block_row">
              <div class="block_data4">
                <div class="block_input_data"><b>Выполненные работы</b></div>
                <textarea class="form-control" placeholder="Комментарий исполнителя" v-model="cardWorkerDescription" disabled></textarea>
              </div>
            </div>
            
            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Выполнил проверку</b></div>
                  <select class="form-select" aria-label="Disabled select example" v-model="cardChecker" disabled>
                    <option disabled selected>Выберите подразделение</option>
                    <option v-for="division in defect_divisions"></option>
                  </select> 
              </div>
              <div class="block_data2">
                <div class="block_input_data">
                  <b>Результат проверки</b>
                </div>
                <input type="text" class="form-control" placeholder="Результат проверки"  disabled>
              </div>
            </div>

            <div class="block-history">
              <h3>История дефекта</h3>
              <div class="table-responsive small">
                <table class="table table-striped table-sm">
                  <thead>
                    <tr >
                      <th scope="col">#</th>
                      <th scope="col">Дата</th>
                      <th scope="col">Статус</th>
                      <th scope="col">Ответственное лицо</th>
                      <th scope="col">Комментарий</th>
                    </tr>
                  </thead>
                  <tbody class="demotable">
                      <tr v-for="cardHistory in cardHistorys">
                        <td >{{ cardHistory.history_date }}</td>
                        <td >{{ cardHistory.history_status }}</td>
                        <td >{{ cardHistory.history_user.user_surname }}</td>
                        <td >{{ cardHistory.history_comment }}</td>
                      </tr>

                  </tbody>
                </table>
              </div>
            </div>

            <div class="modal-footer">
              <button @click="cancelDefect" class="btn btn-primary" type="button">Отменить дефект</button>
              <button @click="confirmDefect" class="btn btn-primary" type="button">Подтвердить дефект</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!----------------------------------------Модальное окно "Принять дефект"------------------------------------------>
<div id="vueAcceptDefect">
  <div class="modal fade" id="AcceptModalWindow" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header status_accept_defect">
          <h2 class="modal-title" id="exampleModalLabel">Принятие дефекта №</h2>
          <h2 class="modal-title" id="exampleModalLabel"> {{ cardDefectID }}</h2>
          <button type="button" class="btn-close"  data-bs-dismiss="modal" aria-label="Close" id="closeAcceptModalWindow"></button>
        </div>
        <div class="modal-body">
          <form method="post">
            <input type="hidden" class="form-control" name="id" value="<?= $employee['id'] ?>">

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Тип дефекта</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardTypeDefectName" disabled>
                    <option disabled selected>Выберите тип дефекта</option>
                    <option v-for="defect_type_defect in defect_type_defects">{{ defect_type_defect.type_defect_name }}</option>
                  </select>
              </div>
              <div class="block_data2">
                  <div class="block_input_data"><b>Статус дефекта</b></div>
                    <input type="text" class="form-control" v-model="cardStatusDefectName" placeholder="Статус дефекта" disabled>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data">
                  <b>KKS</b>
                </div>
                <input type="text" class="form-control" v-model="cardKKS" placeholder="xxxx xxxx xxxx xxxx"
                data-hs-mask-options='{
                  "template": "0000 0000 0000 0000"
                }' disabled>
              </div>
              <div class="block_data2">
                  <div class="block_input_data">
                    <b>Оборудование</b>
                  </div>
                  <input type="text" class="form-control" v-model="cardSystemName" placeholder="Оборудование" disabled>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data3">
                <div class="block_input_data"><b>Описание дефекта</b></div>
                <textarea class="form-control" v-model="cardDescription" placeholder="Описание дефекта" disabled></textarea>
              </div>
              <div class="block_data3">
                <div class="block_input_data"><b>Местоположение</b></div>
                <textarea class="form-control" v-model="cardLocation" placeholder="Местоположение" disabled></textarea>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Подразделение-владелец</b></div>
                  <input type="text" class="form-control" placeholder="Обнаружил дефект"  aria-label="readonly input example" v-model="cardDivisionOwner" disabled>
              </div>
              <div class="block_data2">
                <div class="block_input_data"><b>Обнаружил дефект</b></div>
                  <input type="text" class="form-control" placeholder="Обнаружил дефект"  aria-label="readonly input example" v-model="cardRegistrator" disabled>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data">
                  <b>Дата регистрации</b>
                </div>
                <input type="text" class="form-control" placeholder="Дата регистрации" v-model="cardDateRegistration" disabled>
            </div>
              <div class="block_data2">
                <div class="block_input_data"><b>Руководитель ремонта</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="newRepairManager_id" disabled>
                    <option selected>Выберите руководителя ремонта</option>
                    <option v-for="repair_manager in repair_managers" :value="repair_manager.user_id">{{ repair_manager.user_surname + ' ' + repair_manager.user_name }}</option>
                    <option selected>{{ cardRepairManager }}</option>

                  </select> 
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Срок устранения</b></div>
                  <input class="form-control" type="date" disabled>
              </div>
              <div class="block_data2">
                <div class="block_input_data"><b>Исполнитель ремонта</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardWorker">
                    <option selected disabled>Выберите исполнителя ремонта</option>
                    <option v-for="worker in workers">{{ worker.user_surname + ' ' + worker.user_name }}</option>
                  </select> 
              </div>
            </div>

            <div class="block_row">
              <div class="block_data4">
                <div class="block_input_data"><b>Выполненные работы</b></div>
                <textarea class="form-control" placeholder="Комментарий исполнителя" v-model="cardWorkerDescription" disabled></textarea>
              </div>
            </div>
            
            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Выполнил проверку</b></div>
                  <select class="form-select" aria-label="Disabled select example" v-model="cardChecker" disabled>
                    <option disabled selected>Выберите подразделение</option>
                    <option v-for="division in defect_divisions"></option>
                  </select> 
              </div>
              <div class="block_data2">
                <div class="block_input_data">
                  <b>Результат проверки</b>
                </div>
                <input type="text" class="form-control" placeholder="Результат проверки"  disabled>
              </div>
            </div>

            <div class="block-history">
              <h3>История дефекта</h3>
              <div class="table-responsive small">
                <table class="table table-striped table-sm">
                  <thead>
                    <tr >
                      <th scope="col">#</th>
                      <th scope="col">Дата</th>
                      <th scope="col">Статус</th>
                      <th scope="col">Ответственное лицо</th>
                      <th scope="col">Комментарий</th>
                    </tr>
                  </thead>
                  <tbody class="demotable">
                      <tr v-for="cardHistory in cardHistorys">
                        <td >{{ cardHistory.history_date }}</td>
                        <td >{{ cardHistory.history_status }}</td>
                        <td >{{ cardHistory.history_user.user_surname }}</td>
                        <td >{{ cardHistory.history_comment }}</td>
                      </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="modal-footer">
              <button @click="cancelDefect" class="btn btn-primary" type="button">Требует корректировки</button>
              <button @click="acceptDefect" class="btn btn-primary" type="button">Принять дефект</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>


<!----------------------------------------Модальное окно "Исполнение"------------------------------------------>
<div id="vueExecutionDefect">
  <div class="modal fade" id="ExecutionModalWindow" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header status_execution_defect">
          <h2 class="modal-title" id="exampleModalLabel">Исполнение дефекта №</h2>
          <h2 class="modal-title" id="exampleModalLabel"> {{ cardDefectID }}</h2>
          <button type="button" class="btn-close"  data-bs-dismiss="modal" aria-label="Close" id="closeExecutionModalWindow"></button>
        </div>
        <div class="modal-body">
          <form method="post">
            <input type="hidden" class="form-control" name="id" value="<?= $employee['id'] ?>">

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Тип дефекта</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardTypeDefectName" disabled>
                    <option disabled selected>Выберите тип дефекта</option>
                    <option v-for="defect_type_defect in defect_type_defects">{{ defect_type_defect.type_defect_name }}</option>
                  </select>
              </div>
              <div class="block_data2">
                  <div class="block_input_data"><b>Статус дефекта</b></div>
                    <input type="text" class="form-control" v-model="cardStatusDefectName" placeholder="Статус дефекта" disabled>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data">
                  <b>KKS</b>
                </div>
                <input type="text" class="form-control" v-model="cardKKS" placeholder="xxxx xxxx xxxx xxxx"
                data-hs-mask-options='{
                  "template": "0000 0000 0000 0000"
                }' disabled>
              </div>
              <div class="block_data2">
                  <div class="block_input_data">
                    <b>Оборудование</b>
                  </div>
                  <input type="text" class="form-control" v-model="cardSystemName" placeholder="Оборудование" disabled>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data3">
                <div class="block_input_data"><b>Описание дефекта</b></div>
                <textarea class="form-control" v-model="cardDescription" placeholder="Описание дефекта" disabled></textarea>
              </div>
              <div class="block_data3">
                <div class="block_input_data"><b>Местоположение</b></div>
                <textarea class="form-control" v-model="cardLocation" placeholder="Местоположение" disabled></textarea>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Подразделение-владелец</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardDivisionOwner" disabled>
                    <option disabled selected>Выберите подразделение</option>
                    <option v-for="division in defect_divisions">{{ division.division_name }}</option>
                  </select> 
              </div>
              <div class="block_data2">
                <div class="block_input_data"><b>Обнаружил дефект</b></div>
                  <input type="text" class="form-control" placeholder="Обнаружил дефект"  aria-label="readonly input example" v-model="cardRegistrator" disabled>
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data">
                  <b>Дата регистрации</b>
                </div>
                <input type="text" class="form-control" placeholder="Дата регистрации" v-model="cardDateRegistration" disabled>
            </div>
              <div class="block_data2">
                <div class="block_input_data"><b>Руководитель ремонта</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="newRepairManager_id" disabled>
                    <option selected disabled>Выберите руководителя ремонта</option>
                    <option v-for="repair_manager in repair_managers" :value="repair_manager.user_id">{{ repair_manager.user_surname + ' ' + repair_manager.user_name }}</option>
                  </select> 
              </div>
            </div>

            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Срок устранения</b></div>
                  <input class="form-control" type="date" disabled>
              </div>
              <div class="block_data2">
                <div class="block_input_data"><b>Исполнитель ремонта</b></div>
                  <select class="form-select" aria-label="Default select example" v-model="cardWorker" disabled>
                    <option selected disabled>Выберите исполнителя ремонта</option>
                    <option v-for="worker in workers">{{ worker.user_surname + ' ' + worker.user_name }}</option>
                  </select> 
              </div>
            </div>

            <div class="block_row">
              <div class="block_data4">
                <div class="block_input_data"><b>Выполненные работы</b></div>
                <textarea class="form-control" placeholder="Комментарий исполнителя" v-model="cardWorkerDescription" disabled></textarea>
              </div>
            </div>
            
            <div class="block_row">
              <div class="block_data2">
                <div class="block_input_data"><b>Выполнил проверку</b></div>
                  <select class="form-select" aria-label="Disabled select example" v-model="cardChecker" disabled>
                    <option disabled selected>Выберите подразделение</option>
                    <option v-for="division in defect_divisions"></option>
                  </select> 
              </div>
              <div class="block_data2">
                <div class="block_input_data">
                  <b>Результат проверки</b>
                </div>
                <input type="text" class="form-control" placeholder="Результат проверки"  disabled>
              </div>
            </div>

            <div class="block-history">
              <h3>История дефекта</h3>
              <div class="table-responsive small">
                <table class="table table-striped table-sm">
                  <thead>
                    <tr >
                      <th scope="col">#</th>
                      <th scope="col">Дата</th>
                      <th scope="col">Статус</th>
                      <th scope="col">Ответственное лицо</th>
                      <th scope="col">Комментарий</th>
                    </tr>
                  </thead>
                  <tbody class="demotable">
                      <tr v-for="cardHistory in cardHistorys">
                        <td >{{ cardHistory.history_date }}</td>
                        <td >{{ cardHistory.history_status }}</td>
                        <td >{{ cardHistory.history_user.user_surname }}</td>
                        <td >{{ cardHistory.history_comment }}</td>
                      </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="modal-footer">
              <button @click="cancelDefect" class="btn btn-primary" type="button">Требует корректировки</button>
              <button @click="acceptDefect" class="btn btn-primary" type="button">Принят в ремонт</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

{% endraw %}

{% raw %}
<div id="vueDefect">
  <div>
    <main>
      <div class="table-responsive small">
        <!-- <table class="table table-striped table-sm"> -->
        <table class="table table-bordered table-striped border-primary">
          <tbody>
            <thead>
              <tr class="head_table">
                <th v-for="colunmName in colunmsName">{{ colunmName }}</th>
              </tr>
            </thead>
            <tr @dblclick="handleDoubleClick" data-bs-target="#ConfirmDefectModalWindow" v-for="defect in defects">
              <td >{{ defect.defect_id }}</td>
              <td >{{ defect.defect_created_at }}</td>
              <td >{{ defect.defect_planned_finish_date }}</td>
              <td >{{ defect.defect_owner }}</td>
              <td >{{ defect.defect_system.system_kks }}</td>
              <td >{{ defect.defect_system.system_name }}</td>
              <td >{{ defect.defect_description }}</td>
              <td >{{ defect.defect_status.status_defect_name }}</td>
              <td >{{ defect.defect_repair_manager.user_surname + ' ' + defect.defect_repair_manager.user_name}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>
</div>
{% endraw %}

<script src="{{ url_for('static_js', path='defect-bootstrap.bundle.min.js') }}" crossorigin="anonymous"></script>
<script src="{{ url_for('static_js', path='chart.umd.js') }}" crossorigin="anonymous"></script>
</html>

<script>
  let startDate = document.getElementById('startDate')
  let endDate = document.getElementById('endDate')

  startDate.addEventListener('change',(e)=>{
    let startDateVal = e.target.value
    document.getElementById('startDateSelected').innerText = startDateVal
  })

  endDate.addEventListener('change',(e)=>{
    let endDateVal = e.target.value
    document.getElementById('endDateSelected').innerText = endDateVal
  })  
</script>

<script src="{{ url_for('defect_js', path='head.js') }}"></script>
<script src="{{ url_for('defect_js', path='nav.js') }}"></script>
<script src="{{ url_for('defect_js', path='user.js') }}"></script>
<script src="{{ url_for('defect_js', path='filter.js') }}"></script>
<script src="{{ url_for('defect_js', path='defect.js') }}"></script>
<script src="{{ url_for('defect_js', path='confirm-defect.js') }}"></script>
<script src="{{ url_for('defect_js', path='accept-defect.js') }}"></script>
<script src="{{ url_for('defect_js', path='execution-defect.js') }}"></script>
<script src="{{ url_for('defect_js', path='main-table.js') }}"></script>

